<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>اصلاح کانفیگ‌های V2Ray</title>
    <meta name="description" content="ابزاری برای اصلاح کانفیگ‌های V2Ray" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ipaddr.js/2.0.1/ipaddr.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .bg-cloudflare {
            background-color: #f48120;
        }
        .bg-gcore {
            background-color: #ff4c00;
        }
        .bg-fastly {
            background-color: #ff282d;
        }
        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand me-0" href="https://seramo.github.io/v2ray-config-modifier/">اصلاح کانفیگ</a>
        <ul class="navbar-nav px-0">
            <li class="nav-item">
                <a class="nav-link" href="https://youtu.be/J9g1kbdW8Oc/" target="_blank">آموزش</a>
            </li>
            <li class="nav-item">
                <a class="nav-link ps-0" href="https://github.com/seramo/v2ray-config-modifier/" target="_blank">گیت‌هاب</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="alert" role="alert" id="messageBox" style="display: none;">
                <span id="messageText"></span>
            </div>
        </div>

        <div class="col-12">
            <label for="inputConfig" class="form-label">کانفیگ</label>
            <input type="text" id="inputConfig" class="form-control" placeholder="vless یا vmess" dir="ltr">
        </div>

        <div class="col-12 mt-3">
            <label for="inputType" class="form-label">نوع ورودی</label>
            <select id="inputType" class="form-control" onchange="toggleInputFields()">
                <option value="cidr">رنج آی پی</option>
                <option value="list">لیست آی پی</option>
            </select>
        </div>

        <div class="col-12 mt-3" id="cidrFields">
            <label for="ipRange" class="form-label">رنج آی پی (CIDR)</label>
            <button onclick="loadIPRanges('cloudflare')" class="badge bg-cloudflare border-0 me-1">کلودفلر</button>
            <button onclick="loadIPRanges('gcore')" class="badge bg-gcore border-0 me-1">جی‌کور</button>
            <button onclick="loadIPRanges('fastly')" class="badge bg-fastly border-0 me-1">فستلی</button>
            <textarea id="ipRange" class="form-control" rows="4" placeholder="هر رنج آی پی در یک خط" dir="ltr"></textarea>

            <label for="outputCount" class="form-label mt-3">تعداد خروجی‌ها</label>
            <select id="outputCount" class="form-control">
                <option value="10000">10000</option>
                <option value="20000">20000</option>
                <option value="30000">30000</option>
                <option value="40000">40000</option>
                <option value="50000">50000</option>
                <option value="unlimited">بدون محدودیت</option>
            </select>
        </div>

        <div class="col-12 mt-3" id="listFields" style="display: none;">
            <label for="ipList" class="form-label">لیست آی پی‌</label>
            <textarea id="ipList" class="form-control" rows="8" placeholder="هر آی پی در یک خط" dir="ltr"></textarea>
        </div>

        <div class="col-12 mt-4">
            <button onclick="generateConfigs()" class="btn btn-primary">تولید کانفیگ‌ها</button>
            <button onclick="copyToClipboard()" class="btn btn-secondary px-4" id="copyButton" style="display: none;">کپی</button>
            <button onclick="downloadOutput()" class="btn btn-success px-4" id="downloadButton" style="display: none;">دانلود</button>
        </div>
    </div>
</div>
<script>
    let generatedOutput = '';

    function showMessage(message, type) {
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        messageText.textContent = message;

        messageBox.classList.remove('alert-success', 'alert-danger', 'alert-warning');

        switch(type) {
            case 'success':
                messageBox.classList.add('alert-success');
                break;
            case 'warning':
                messageBox.classList.add('alert-warning');
                break;
            case 'error':
            default:
                messageBox.classList.add('alert-danger');
        }

        messageBox.style.display = 'block';
    }

    function showError(message) {
        showMessage(message, 'error');
    }

    function showWarning(message) {
        showMessage(message, 'warning');
    }

    function showSuccess(message) {
        showMessage(message, 'success');
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function toggleInputFields() {
        const inputType = document.getElementById('inputType').value;
        const cidrFields = document.getElementById('cidrFields');
        const listFields = document.getElementById('listFields');

        if (inputType === 'cidr') {
            cidrFields.style.display = 'block';
            listFields.style.display = 'none';
        } else {
            cidrFields.style.display = 'none';
            listFields.style.display = 'block';
        }
    }

    function isValidCIDR(cidr) {
        return /^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/.test(cidr) || /^[0-9a-fA-F:]+\/\d{1,3}$/.test(cidr);
    }

    function incrementIP(ip) {
        if (ip.kind() === 'ipv4') {
            let currentIpNumeric = ip.octets.reduce((acc, octet) => (acc << 8) + octet, 0);
            currentIpNumeric += 1;
            const nextIpOctets = [
                (currentIpNumeric >>> 24) & 0xFF,
                (currentIpNumeric >>> 16) & 0xFF,
                (currentIpNumeric >>> 8) & 0xFF,
                currentIpNumeric & 0xFF
            ];
            return new ipaddr.IPv4(nextIpOctets);
        } else if (ip.kind() === 'ipv6') {
            let parts = ip.parts.map(part => BigInt(part));
            let i = parts.length - 1;
            while (i >= 0) {
                parts[i] = parts[i] + 1n;
                if (parts[i] > 0xFFFFn) {
                    parts[i] = 0n;
                    i--;
                } else {
                    break;
                }
            }
            return ipaddr.IPv6.parse(parts.map(part => part.toString(16)).join(':'));
        }
    }

    function isValidConfigFormat(inputConfig) {
        if (inputConfig.startsWith('vmess://')) {
            return true;
        } else if (inputConfig.startsWith('vless://')) {
            const regex = /vless:\/\/[^@]+@[^:]+:.+/;
            return regex.test(inputConfig);
        }
        return false;
    }

    function generateConfigs() {
        const inputType = document.getElementById('inputType').value;
        const inputConfig = document.getElementById('inputConfig').value;

        if (!inputConfig) {
            showWarning('لطفا کانفیگ را وارد کنید.');
            return;
        }

        if (!isValidConfigFormat(inputConfig)) {
            showWarning('کانفیگ وارد شده معتبر نیست.');
            return;
        }

        if (inputType === 'cidr') {
            modifyConfigsFromCIDR();
        } else {
            modifyConfigsFromList();
        }
    }

    function modifyConfigsFromCIDR() {
        const inputConfig = document.getElementById('inputConfig').value;
        const ipRanges = document.getElementById('ipRange').value.trim().split('\n').filter(range => range.trim() !== '');
        const outputCount = document.getElementById('outputCount').value;

        if (ipRanges.length === 0) {
            showWarning('لطفا حداقل یک رنج آی پی را وارد کنید.');
            return;
        }

        for (const ipRange of ipRanges) {
            if (!isValidCIDR(ipRange.trim())) {
                showWarning(`لطفا یک رنج آی پی معتبر وارد کنید: ${ipRange}`);
                return;
            }
        }

        generatedOutput = '';
        let count = 0;

        for (const ipRange of ipRanges) {
            const [ip, range] = ipaddr.parseCIDR(ipRange.trim());
            const ipType = ip.kind();

            if (outputCount === 'unlimited' && ipType === 'ipv6') {
                showWarning('تعداد خروجی بدون محدودیت فقط برای رنج آی پی های ورژن 4 قابل استفاده است.');
                return;
            }

            let currentIp = ip;
            while (currentIp.match(ipaddr.parseCIDR(ipRange.trim())) && (outputCount === 'unlimited' || count < parseInt(outputCount))) {
                generatedOutput += replaceIPInConfig(inputConfig, currentIp);
                count++;

                if (outputCount !== 'unlimited' && count >= parseInt(outputCount)) {
                    break;
                }

                currentIp = incrementIP(currentIp);
            }
        }

        displayResult(count);
    }

    function modifyConfigsFromList() {
        const inputConfig = document.getElementById('inputConfig').value;
        const ipList = document.getElementById('ipList').value.trim().split('\n').filter(ip => ip.trim() !== '');

        if (ipList.length === 0) {
            showWarning('لطفا لیست آی پی‌ را وارد کنید.');
            return;
        }

        generatedOutput = '';

        for (const ip of ipList) {
            let ipStr = ip.trim();
            if (ipaddr.isValid(ipStr)) {
                generatedOutput += replaceIPInConfig(inputConfig, ipaddr.parse(ipStr));
            } else {
                showWarning(`آی پی نامعتبر یافت شد: ${ipStr}`);
                return;
            }
        }

        displayResult(ipList.length);
    }

    function replaceIPInConfig(inputConfig, ip) {
        let isVmess = inputConfig.startsWith('vmess://');
        let ipStr = ip.toString();
        let result = '';

        if (isVmess) {
            let vmessConfig = JSON.parse(atob(inputConfig.replace('vmess://', '')));
            vmessConfig.add = ipStr;
            result = `vmess://${btoa(JSON.stringify(vmessConfig))}\n\n`;
        } else {
            ipStr = ip.kind() === 'ipv6' ? `[${ipStr}]` : ipStr;
            const match = inputConfig.match(/^(vless:\/\/[^@]+)@([^:]+)(:.+)$/);
            const [_, start, domain, end] = match;
            result = `${start}@${ipStr}${end}\n\n`;
        }

        return result;
    }

    function displayResult(count) {
        const copyButton = document.getElementById('copyButton');
        const downloadButton = document.getElementById('downloadButton');

        if (generatedOutput) {
            showSuccess(`تولید ${count} کانفیگ با موفقیت انجام شد.`);
            copyButton.style.display = 'inline-block';
            downloadButton.style.display = 'inline-block';
        } else {
            showError('هیچ کانفیگی تولید نشد.');
            copyButton.style.display = 'none';
            downloadButton.style.display = 'none';
        }
    }

    function loadIPRanges(service) {
        let ipRanges = [];

        switch(service) {
            case 'cloudflare':
                ipRanges = [
                    "173.245.48.0/20",
                    "103.21.244.0/22",
                    "103.22.200.0/22",
                    "103.31.4.0/22",
                    "141.101.64.0/18",
                    "108.162.192.0/18",
                    "190.93.240.0/20",
                    "188.114.96.0/20",
                    "197.234.240.0/22",
                    "198.41.128.0/17",
                    "162.158.0.0/15",
                    "104.16.0.0/13",
                    "104.24.0.0/14",
                    "172.64.0.0/13",
                    "131.0.72.0/22"
                ];
                break;
            case 'gcore':
                ipRanges = [
                    "80.15.228.1/32",
                    "92.223.116.232/32",
                    "193.169.250.9/32",
                    "80.15.230.15/32",
                    "45.82.101.5/32",
                    "193.242.96.5/32",
                    "45.80.213.5/32",
                    "92.223.61.25/32",
                    "80.15.228.3/32",
                    "93.123.17.170/32",
                    "93.123.11.17/32",
                    "92.223.107.53/32",
                    "195.22.198.49/32",
                    "45.68.4.2/32",
                    "95.85.88.9/32",
                    "80.15.248.3/32",
                    "92.223.12.10/32",
                    "45.82.101.6/32",
                    "5.252.26.7/32",
                    "103.178.28.13/32",
                    "92.223.107.54/32",
                    "92.223.118.17/32",
                    "92.223.116.200/32",
                    "193.169.250.4/32",
                    "195.14.146.81/32",
                    "92.223.118.13/32",
                    "93.123.17.161/32",
                    "151.248.104.69/32",
                    "92.223.40.11/32",
                    "92.38.170.6/32",
                    "92.223.123.47/32",
                    "93.123.38.5/32",
                    "92.223.124.52/32",
                    "92.223.122.187/32",
                    "92.223.123.46/32",
                    "197.215.140.234/32",
                    "80.15.244.13/32",
                    "79.133.108.15/32",
                    "92.223.116.244/32",
                    "103.178.29.8/32",
                    "92.223.107.44/32",
                    "92.223.107.45/32",
                    "92.223.63.5/32",
                    "91.243.87.5/32",
                    "93.123.17.158/32",
                    "185.188.144.7/32",
                    "92.223.12.27/32",
                    "92.223.63.6/32",
                    "93.123.11.16/32",
                    "80.15.244.1/32",
                    "93.123.17.160/32",
                    "102.130.69.141/32",
                    "92.223.116.221/32",
                    "79.133.108.29/32",
                    "92.223.40.12/32",
                    "92.223.116.214/32",
                    "82.148.98.42/32",
                    "80.93.215.9/32",
                    "80.15.252.67/32",
                    "92.38.168.5/32",
                    "93.123.17.155/32",
                    "92.223.114.6/32",
                    "80.15.251.21/32",
                    "79.133.108.26/32",
                    "80.15.243.15/32",
                    "92.223.116.204/32",
                    "62.112.223.4/32",
                    "5.101.68.5/32",
                    "181.39.11.210/32",
                    "45.65.8.4/32",
                    "92.223.76.25/32",
                    "92.223.124.49/32",
                    "92.223.63.9/32",
                    "94.128.12.238/32",
                    "92.223.118.199/32",
                    "102.67.99.66/32",
                    "194.158.198.1/32",
                    "193.169.251.9/32",
                    "200.24.129.99/32",
                    "194.158.198.2/32",
                    "93.123.17.169/32",
                    "78.111.110.5/32",
                    "41.226.6.202/32",
                    "92.223.124.17/32",
                    "92.223.63.24/32",
                    "5.8.92.5/32",
                    "200.24.129.98/32",
                    "92.223.116.230/32",
                    "92.223.12.15/32",
                    "79.133.108.8/32",
                    "92.223.12.11/32",
                    "92.223.40.9/32",
                    "80.15.230.3/32",
                    "93.123.17.188/32",
                    "92.223.118.28/32",
                    "92.223.108.13/32",
                    "37.239.145.3/32",
                    "95.85.69.6/32",
                    "79.133.108.13/32",
                    "92.223.124.27/32",
                    "194.44.246.206/32",
                    "62.112.216.8/32",
                    "92.223.47.4/32",
                    "80.240.113.5/32",
                    "5.188.133.10/32",
                    "92.223.124.18/32",
                    "92.223.107.48/32",
                    "92.223.124.54/32",
                    "80.15.252.45/32",
                    "192.16.87.145/32",
                    "103.178.28.16/32",
                    "94.129.12.210/32",
                    "89.223.90.4/32",
                    "31.184.207.10/32",
                    "95.85.92.6/32",
                    "92.223.12.23/32",
                    "93.123.11.18/32",
                    "193.169.251.5/32",
                    "92.223.116.231/32",
                    "197.215.44.65/32",
                    "80.240.113.6/32",
                    "92.223.107.49/32",
                    "92.223.124.37/32",
                    "93.123.38.4/32",
                    "80.15.231.1/32",
                    "176.222.187.178/32",
                    "5.188.121.165/32",
                    "213.156.144.4/32",
                    "80.240.124.10/32",
                    "80.240.113.4/32",
                    "92.223.107.56/32",
                    "5.101.217.4/32",
                    "92.223.12.25/32",
                    "80.15.252.43/32",
                    "92.223.107.43/32",
                    "80.93.219.4/32",
                    "5.188.121.185/32",
                    "45.82.100.5/32",
                    "5.188.121.162/32",
                    "92.223.107.47/32",
                    "193.242.96.4/32",
                    "92.223.118.24/32",
                    "92.38.170.8/32",
                    "45.82.103.4/32",
                    "5.101.222.5/32",
                    "87.120.164.5/32",
                    "91.149.176.68/32",
                    "37.110.209.228/32",
                    "197.215.140.235/32",
                    "103.178.28.10/32",
                    "92.223.40.14/32",
                    "92.223.40.18/32",
                    "92.223.107.57/32",
                    "5.8.92.4/32",
                    "92.223.118.198/32",
                    "103.178.28.14/32",
                    "45.82.100.4/32",
                    "5.188.94.5/32",
                    "91.185.14.226/32",
                    "37.17.119.212/32",
                    "94.176.183.7/32",
                    "92.223.116.211/32",
                    "92.223.74.26/32",
                    "185.188.144.8/32",
                    "5.101.68.8/32",
                    "92.223.116.222/32",
                    "92.223.40.6/32",
                    "185.211.231.186/32",
                    "103.178.28.5/32",
                    "92.223.40.8/32",
                    "213.156.144.5/32",
                    "93.123.17.185/32",
                    "93.123.17.174/32",
                    "92.38.170.7/32",
                    "93.123.11.19/32",
                    "93.123.17.175/32",
                    "80.15.251.9/32",
                    "190.95.248.34/32",
                    "92.223.114.7/32",
                    "92.223.123.20/32",
                    "185.194.11.74/32",
                    "92.223.40.4/32",
                    "5.188.132.6/32",
                    "80.240.124.9/32",
                    "93.123.17.180/32",
                    "92.223.118.18/32",
                    "109.61.41.9/32",
                    "92.223.63.28/32",
                    "5.189.207.5/32",
                    "213.156.144.6/32",
                    "80.15.230.13/32",
                    "146.185.221.132/32",
                    "92.223.107.42/32",
                    "92.223.124.5/32",
                    "80.15.252.33/32",
                    "79.133.108.31/32",
                    "5.252.26.4/32",
                    "217.195.193.4/32",
                    "197.148.108.106/32",
                    "92.223.63.23/32",
                    "79.133.108.28/32",
                    "80.15.251.23/32",
                    "80.15.232.3/32",
                    "82.97.205.5/32",
                    "92.223.120.10/32",
                    "92.223.76.22/32",
                    "80.15.252.61/32",
                    "200.24.129.100/32",
                    "93.123.17.151/32",
                    "185.215.162.226/32",
                    "92.223.12.26/32",
                    "92.223.124.33/32",
                    "92.223.107.46/32",
                    "92.223.120.14/32",
                    "80.15.243.13/32",
                    "94.176.183.8/32",
                    "103.178.28.15/32",
                    "93.123.17.178/32",
                    "92.223.116.216/32",
                    "194.158.198.4/32",
                    "45.82.101.8/32",
                    "80.15.252.9/32",
                    "78.111.103.5/32",
                    "80.93.215.7/32",
                    "5.188.121.166/32",
                    "92.223.40.10/32",
                    "194.158.198.6/32",
                    "80.15.230.1/32",
                    "45.82.101.7/32",
                    "92.223.116.212/32",
                    "80.240.113.14/32",
                    "80.15.244.15/32",
                    "92.223.118.200/32",
                    "62.112.216.10/32",
                    "92.223.118.196/32",
                    "80.15.229.3/32",
                    "93.123.17.194/32",
                    "92.223.40.15/32",
                    "103.178.28.12/32",
                    "92.223.116.228/32",
                    "92.223.122.185/32",
                    "80.15.231.3/32",
                    "92.223.124.23/32",
                    "92.223.118.23/32",
                    "92.223.123.32/32",
                    "80.15.247.1/32",
                    "93.123.17.132/32",
                    "93.123.17.134/32",
                    "43.245.140.2/32",
                    "92.38.142.21/32",
                    "80.15.250.1/32",
                    "92.223.76.21/32",
                    "37.239.145.2/32",
                    "102.67.99.50/32",
                    "195.216.237.197/32",
                    "80.15.247.3/32",
                    "185.249.133.4/32",
                    "79.133.108.16/32",
                    "200.10.177.54/32",
                    "92.223.12.16/32",
                    "5.188.121.135/32",
                    "103.178.29.11/32",
                    "5.101.219.6/32",
                    "92.223.124.53/32",
                    "193.169.251.8/32",
                    "92.223.63.29/32",
                    "93.123.17.139/32",
                    "66.84.78.146/32",
                    "92.223.12.7/32",
                    "95.85.92.4/32",
                    "92.223.107.58/32",
                    "66.84.78.145/32",
                    "31.184.207.4/32",
                    "92.223.12.8/32",
                    "93.123.17.190/32",
                    "92.223.120.15/32",
                    "80.15.252.63/32",
                    "92.223.118.16/32",
                    "92.223.118.27/32",
                    "5.188.121.192/32",
                    "95.85.92.5/32",
                    "80.93.215.5/32",
                    "80.93.221.4/32",
                    "80.240.124.5/32",
                    "92.223.63.4/32",
                    "5.252.26.5/32",
                    "185.48.136.150/32",
                    "92.223.118.25/32",
                    "92.223.63.8/32",
                    "202.78.162.5/32",
                    "5.188.121.181/32",
                    "92.223.40.16/32",
                    "79.133.108.25/32",
                    "92.223.124.24/32",
                    "92.223.118.26/32",
                    "193.169.251.4/32",
                    "92.223.123.50/32",
                    "93.115.241.4/32",
                    "92.223.118.197/32",
                    "92.223.107.60/32",
                    "5.188.126.6/32",
                    "66.84.78.137/32",
                    "125.214.163.193/32",
                    "5.188.133.13/32",
                    "92.223.124.11/32",
                    "92.223.78.23/32",
                    "94.176.183.12/32",
                    "94.176.183.5/32",
                    "213.156.151.6/32",
                    "93.123.11.13/32",
                    "217.195.193.5/32",
                    "92.38.168.6/32",
                    "92.223.116.239/32",
                    "93.123.17.141/32",
                    "93.123.17.195/32",
                    "92.223.124.48/32",
                    "62.112.216.9/32",
                    "94.176.183.6/32",
                    "80.240.124.6/32",
                    "5.188.121.161/32",
                    "46.49.10.231/32",
                    "103.178.28.6/32",
                    "185.163.3.4/32",
                    "80.15.251.25/32",
                    "202.129.236.162/32",
                    "62.112.223.5/32",
                    "80.15.251.11/32",
                    "92.223.124.28/32",
                    "103.178.29.9/32",
                    "92.223.116.235/32",
                    "92.223.118.19/32",
                    "80.93.215.11/32",
                    "92.223.124.47/32",
                    "109.61.41.7/32",
                    "185.188.144.5/32",
                    "80.15.252.65/32",
                    "109.61.41.5/32",
                    "5.101.219.5/32",
                    "80.240.124.7/32",
                    "92.223.12.17/32",
                    "92.223.116.227/32",
                    "79.133.108.23/32",
                    "160.32.246.129/32",
                    "92.223.124.31/32",
                    "80.15.248.15/32",
                    "80.240.113.12/32",
                    "93.123.17.189/32",
                    "118.103.136.245/32",
                    "92.223.116.229/32",
                    "92.223.55.6/32",
                    "90.84.153.67/32",
                    "181.174.80.182/32",
                    "103.178.29.7/32",
                    "92.223.76.23/32",
                    "92.223.124.26/32",
                    "45.80.213.8/32",
                    "80.93.215.8/32",
                    "103.178.28.4/32",
                    "92.223.107.36/32",
                    "80.15.252.41/32",
                    "185.163.3.6/32",
                    "134.0.219.37/32",
                    "80.15.232.1/32",
                    "109.61.41.8/32",
                    "80.93.219.5/32",
                    "92.223.118.4/32",
                    "92.223.116.220/32",
                    "80.93.215.12/32",
                    "192.16.87.153/32",
                    "92.223.40.19/32",
                    "45.80.213.6/32",
                    "5.188.126.4/32",
                    "85.92.120.117/32",
                    "92.223.124.4/32",
                    "217.195.193.6/32",
                    "185.101.136.8/32",
                    "94.43.206.202/32",
                    "92.223.124.22/32",
                    "92.223.12.12/32",
                    "92.223.122.188/32",
                    "5.188.126.5/32",
                    "92.223.124.56/32",
                    "90.84.153.98/32",
                    "92.223.107.55/32",
                    "82.213.5.50/32",
                    "92.223.118.40/32",
                    "80.15.252.47/32",
                    "92.223.55.5/32",
                    "92.223.61.21/32",
                    "93.123.17.192/32",
                    "185.158.211.186/32",
                    "92.223.64.12/32",
                    "92.223.124.45/32",
                    "93.123.17.157/32",
                    "66.84.78.129/32",
                    "193.36.180.5/32",
                    "93.123.17.133/32",
                    "79.133.108.32/32",
                    "5.188.121.133/32",
                    "92.223.12.5/32",
                    "150.107.126.5/32",
                    "92.223.124.15/32",
                    "92.223.120.13/32",
                    "213.156.156.4/32",
                    "109.68.233.242/32",
                    "92.223.112.28/32",
                    "5.101.222.6/32",
                    "92.223.63.22/32",
                    "93.123.17.166/32",
                    "31.184.207.11/32",
                    "80.15.235.27/32",
                    "93.123.17.156/32",
                    "92.223.116.233/32",
                    "80.15.250.9/32",
                    "92.223.124.44/32",
                    "92.223.47.6/32",
                    "45.82.101.9/32",
                    "80.15.251.31/32",
                    "92.223.40.7/32",
                    "93.123.17.186/32",
                    "154.120.250.210/32",
                    "93.123.17.176/32",
                    "193.169.250.8/32",
                    "79.133.108.30/32",
                    "92.223.76.26/32",
                    "93.123.17.162/32",
                    "92.223.124.25/32",
                    "195.216.237.201/32",
                    "93.123.17.182/32",
                    "92.223.116.226/32",
                    "92.223.124.43/32",
                    "160.32.246.137/32",
                    "185.101.136.9/32",
                    "92.223.63.27/32",
                    "79.133.108.5/32",
                    "92.223.110.4/32",
                    "80.15.251.29/32",
                    "80.15.248.1/32",
                    "93.123.17.167/32",
                    "92.223.12.14/32",
                    "93.123.17.136/32",
                    "92.223.116.240/32",
                    "92.223.118.22/32",
                    "193.36.180.6/32",
                    "92.223.124.36/32",
                    "92.223.123.34/32",
                    "80.15.233.3/32",
                    "5.252.26.6/32",
                    "90.84.153.65/32",
                    "92.223.107.51/32",
                    "80.240.113.7/32",
                    "92.223.107.52/32",
                    "5.189.207.4/32",
                    "5.8.92.6/32",
                    "92.223.63.11/32",
                    "80.93.215.4/32",
                    "213.156.151.5/32",
                    "92.223.124.16/32",
                    "92.223.12.24/32",
                    "194.158.198.3/32",
                    "93.123.17.184/32",
                    "79.133.108.4/32",
                    "103.211.151.21/32",
                    "92.223.118.14/32",
                    "92.223.122.184/32",
                    "78.111.110.4/32",
                    "92.223.112.12/32",
                    "139.28.7.4/32",
                    "5.8.43.4/32",
                    "92.223.124.46/32",
                    "92.223.76.24/32",
                    "103.178.28.7/32",
                    "185.101.136.12/32",
                    "92.223.118.37/32",
                    "192.16.87.137/32",
                    "125.214.171.164/32",
                    "92.223.116.236/32",
                    "80.93.215.10/32",
                    "92.223.122.186/32",
                    "93.123.11.11/32",
                    "5.252.26.10/32",
                    "213.156.144.7/32",
                    "80.240.113.8/32",
                    "92.38.159.4/32",
                    "80.15.229.1/32",
                    "79.133.108.17/32",
                    "92.223.108.5/32",
                    "92.223.116.238/32",
                    "92.223.124.51/32",
                    "92.223.107.39/32",
                    "92.223.118.8/32",
                    "78.111.110.6/32",
                    "92.223.107.38/32",
                    "91.243.83.5/32",
                    "80.15.233.1/32",
                    "37.17.119.211/32",
                    "93.115.241.5/32",
                    "93.123.17.193/32",
                    "193.242.96.6/32",
                    "185.105.1.10/32",
                    "213.156.156.5/32",
                    "5.188.132.5/32",
                    "80.15.235.13/32",
                    "92.223.124.8/32",
                    "92.38.142.25/32",
                    "78.111.101.4/32",
                    "80.240.113.11/32",
                    "185.101.136.7/32",
                    "80.15.247.15/32",
                    "80.15.243.1/32",
                    "92.223.74.20/32",
                    "5.1.107.249/32",
                    "92.38.168.7/32",
                    "92.223.40.5/32",
                    "92.223.116.234/32",
                    "80.15.235.3/32",
                    "103.178.28.9/32",
                    "93.123.17.137/32",
                    "193.169.250.5/32",
                    "80.93.210.4/32",
                    "92.223.76.28/32",
                    "80.240.113.13/32",
                    "90.84.153.99/32",
                    "90.84.153.195/32",
                    "90.84.153.18/32",
                    "80.15.246.13/32",
                    "92.223.124.29/32",
                    "90.84.153.163/32",
                    "90.84.153.193/32",
                    "90.84.153.97/32",
                    "90.84.153.225/32",
                    "90.84.153.35/32",
                    "90.84.153.19/32",
                    "90.84.153.194/32",
                    "90.84.153.66/32",
                    "195.216.237.199/32",
                    "92.223.107.40/32",
                    "79.133.108.10/32",
                    "90.84.153.129/32",
                    "90.84.153.17/32",
                    "90.84.153.162/32",
                    "90.84.153.161/32",
                    "90.84.153.131/32",
                    "90.84.153.34/32",
                    "90.84.153.226/32",
                    "90.84.153.227/32",
                    "90.84.153.33/32",
                    "92.223.118.21/32",
                    "90.84.153.130/32",
                    "93.123.17.153/32",
                    "92.223.124.13/32",
                    "5.252.26.9/32",
                    "185.76.48.122/32",
                    "92.223.12.18/32",
                    "197.188.22.102/32",
                    "93.123.17.187/32",
                    "93.123.17.154/32",
                    "80.15.246.1/32",
                    "213.156.151.4/32",
                    "80.15.251.1/32",
                    "93.123.17.179/32",
                    "95.85.92.7/32",
                    "78.111.101.5/32",
                    "103.178.29.5/32",
                    "92.38.159.7/32",
                    "192.16.87.161/32",
                    "130.193.166.2/32",
                    "193.169.250.7/32",
                    "80.15.247.13/32",
                    "5.188.121.191/32",
                    "93.123.11.14/32",
                    "79.133.108.6/32",
                    "46.49.10.229/32",
                    "93.123.17.181/32",
                    "45.80.213.7/32",
                    "92.223.116.201/32",
                    "92.223.124.6/32",
                    "185.244.209.4/32",
                    "93.123.11.12/32",
                    "93.123.17.140/32",
                    "92.223.63.26/32",
                    "91.243.87.4/32",
                    "92.223.124.10/32",
                    "5.188.126.7/32",
                    "92.223.55.4/32",
                    "80.15.243.3/32",
                    "92.223.107.50/32",
                    "5.252.26.8/32",
                    "92.223.40.17/32",
                    "92.223.43.14/32",
                    "80.15.235.1/32",
                    "92.223.116.213/32",
                    "5.8.43.5/32",
                    "92.223.114.14/32",
                    "93.123.17.143/32",
                    "92.223.118.20/32",
                    "197.225.145.26/32",
                    "79.133.108.9/32",
                    "79.133.108.24/32",
                    "92.223.43.13/32",
                    "92.223.124.35/32",
                    "109.61.41.4/32",
                    "92.223.118.7/32",
                    "186.2.150.34/32",
                    "93.123.17.183/32",
                    "41.210.189.22/32",
                    "80.240.124.11/32",
                    "82.97.205.4/32",
                    "92.223.124.34/32",
                    "79.133.108.27/32",
                    "92.223.76.27/32",
                    "62.112.216.11/32",
                    "80.15.235.15/32",
                    "1.37.77.98/32",
                    "92.223.116.223/32",
                    "186.16.19.94/32",
                    "78.111.103.4/32",
                    "31.184.207.7/32",
                    "45.82.103.8/32",
                    "180.149.90.66/32",
                    "93.123.17.142/32",
                    "31.184.207.6/32",
                    "92.223.12.4/32",
                    "92.223.116.237/32",
                    "92.223.118.5/32",
                    "92.223.12.22/32",
                    "92.223.63.21/32",
                    "5.101.222.7/32",
                    "80.240.124.4/32",
                    "92.223.118.38/32",
                    "92.223.63.10/32",
                    "92.223.12.13/32",
                    "45.82.103.6/32",
                    "62.209.27.232/32",
                    "103.178.28.11/32",
                    "80.15.235.25/32",
                    "193.169.251.6/32",
                    "92.223.12.6/32",
                    "80.15.246.3/32",
                    "194.158.198.5/32",
                    "92.223.118.10/32",
                    "45.80.213.4/32",
                    "80.93.215.6/32",
                    "193.169.251.7/32",
                    "80.240.113.10/32",
                    "93.123.17.165/32",
                    "193.57.89.5/32",
                    "79.133.108.14/32",
                    "194.158.198.7/32",
                    "185.188.144.4/32",
                    "79.133.108.7/32",
                    "62.112.216.5/32",
                    "217.76.64.195/32",
                    "80.15.246.15/32",
                    "87.120.164.6/32",
                    "179.51.50.82/32",
                    "103.178.29.10/32",
                    "193.57.89.4/32",
                    "193.169.251.10/32",
                    "92.223.107.59/32",
                    "92.223.116.215/32",
                    "80.93.223.4/32",
                    "31.184.207.9/32",
                    "87.120.164.7/32",
                    "92.223.116.242/32",
                    "92.223.123.48/32",
                    "92.223.124.55/32",
                    "31.184.207.8/32",
                    "92.223.118.201/32",
                    "92.223.118.202/32",
                    "92.223.124.32/32",
                    "80.15.244.3/32",
                    "92.223.123.45/32",
                    "62.112.216.12/32",
                    "109.61.41.6/32",
                    "94.176.183.11/32",
                    "92.223.118.39/32",
                    "31.184.207.5/32",
                    "62.112.216.6/32",
                    "170.238.234.217/32",
                    "5.188.121.138/32",
                    "92.223.118.15/32",
                    "92.223.12.20/32",
                    "93.123.17.177/32",
                    "92.223.116.241/32",
                    "92.223.124.9/32",
                    "92.38.159.6/32",
                    "91.149.176.70/32",
                    "150.107.126.4/32",
                    "80.15.252.17/32",
                    "95.85.92.8/32",
                    "31.184.207.12/32",
                    "103.178.29.6/32",
                    "192.16.87.129/32",
                    "92.223.123.51/32",
                    "92.223.78.22/32",
                    "92.223.120.12/32",
                    "82.200.205.204/32",
                    "103.178.29.4/32",
                    "92.223.116.224/32",
                    "5.188.121.183/32",
                    "92.223.116.225/32",
                    "92.223.12.19/32",
                    "93.123.17.191/32",
                    "109.230.114.2/32",
                    "92.223.63.7/32",
                    "185.101.136.13/32",
                    "45.82.103.5/32",
                    "92.38.170.10/32",
                    "80.240.113.9/32",
                    "5.188.121.182/32",
                    "92.223.64.4/32",
                    "92.223.123.41/32",
                    "92.38.159.5/32",
                    "80.15.251.15/32",
                    "103.178.28.8/32",
                    "92.223.116.243/32",
                    "5.101.222.4/32",
                    "92.223.124.30/32",
                    "93.123.17.135/32",
                    "5.188.121.184/32",
                    "202.78.162.4/32",
                    "93.123.17.168/32",
                    "213.252.220.4/32",
                    "80.15.252.209/32",
                    "37.17.119.210/32",
                    "92.223.63.25/32",
                    "92.223.74.21/32",
                    "195.216.237.203/32",
                    "92.223.118.12/32",
                    "185.163.3.5/32",
                    "217.195.193.7/32",
                    "87.120.164.4/32",
                    "151.248.104.91/32",
                    "92.223.124.50/32",
                    "5.188.121.132/32",
                    "80.240.124.8/32",
                    "80.15.251.13/32",
                    "202.78.162.6/32",
                    "92.223.12.9/32",
                    "134.0.219.26/32",
                    "80.15.248.13/32",
                    "87.120.167.42/32",
                    "87.120.167.72/32",
                    "87.120.167.96/32",
                    "109.61.16.35/32",
                    "109.61.16.109/32",
                    "109.61.16.98/32",
                    "95.85.93.31/32",
                    "95.85.93.160/32",
                    "95.85.93.155/32",
                    "91.243.81.199/32",
                    "91.243.81.66/32",
                    "91.243.81.20/32"
                ];
                break;
            case 'fastly':
                ipRanges = [
                    "23.235.32.0/20",
                    "43.249.72.0/22",
                    "103.244.50.0/24",
                    "103.245.222.0/23",
                    "103.245.224.0/24",
                    "104.156.80.0/20",
                    "140.248.64.0/18",
                    "140.248.128.0/17",
                    "146.75.0.0/17",
                    "151.101.0.0/16",
                    "157.52.64.0/18",
                    "167.82.0.0/17",
                    "167.82.128.0/20",
                    "167.82.160.0/20",
                    "167.82.224.0/20",
                    "172.111.64.0/18",
                    "185.31.16.0/22",
                    "199.27.72.0/21",
                    "199.232.0.0/16"
                ];
                break;
            default:
                showError('رنج آی پی موردنظر وجود ندارد.');
                return;
        }

        const shuffledIPRanges = shuffleArray(ipRanges).slice(0, 4);

        document.getElementById('ipRange').value = shuffledIPRanges.join('\n');
    }

    function copyToClipboard() {
        if (generatedOutput) {
            navigator.clipboard.writeText(generatedOutput.replace(/\n\n/g, '\n').trimEnd()).then(() => {
                showSuccess('کانفیگ‌ها در کلیپ‌بورد ذخیره شدند.');
            }).catch(err => {
                console.error(err);
                showError('خطا در کپی: ' + err);
            });
        }
    }

    function downloadOutput() {
        if (generatedOutput) {
            const blob = new Blob([generatedOutput.replace(/\n\n/g, '\n').trimEnd()], { type: 'text/plain' });
            const now = new Date();
            const date = now.toISOString().split('T')[0];
            const time = now.toTimeString().split(' ')[0].replace(/:/g, '-');
            const fileName = `modified_configs_${date}_${time}.txt`;

            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(link.href);
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>